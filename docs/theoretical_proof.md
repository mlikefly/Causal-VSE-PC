# Causal-VSE-PC 理论证明（含因果推断）

**文档版本**: 1.0  
**创建日期**: 2025年12月  
**核心创新**: 因果推断驱动的加密策略 + 轻量级可验证性

---

## 一、模型与假设

### 1.1 结构因果模型（SCM）

- 节点：X(语义区域:敏感/任务/背景), T(任务类型), Z(隐私预算/加密强度), Y(任务性能)
- 边：X→Z，T→Z，Z→Y
- 扰动：U_X, U_T, U_Z, U_Y 独立

### 1.2 可识别性假设

- 无混淆：给定X,T后，Z对Y的因果效应可识别  
- 一致性：干预 do(Z=z) 与观察到 Z=z 的结果一致  
- 正性：∀x,t,z，P(Z=z|X=x,T=t) > 0  

### 1.3 可识别性证明（Backdoor Adjustment）

#### 1.3.1 DAG结构与混淆变量识别

**结构因果模型（SCM）的DAG表示**:
```
X (语义区域类型) ────┐
                     ├──→ Z (加密强度/隐私预算)
T (任务类型) ────────┘    │
                           │
                           ▼
                        Y (任务性能)
```

**混淆变量识别**:
- $X$ (语义区域类型): 既影响加密策略 $Z$，又影响任务性能 $Y$（敏感区域性能通常较高）
- $T$ (任务类型): 既影响加密策略 $Z$（不同任务需要不同强度），又影响性能基准 $Y$

因此，$\{X, T\}$ 构成了从 $Z$ 到 $Y$ 的 **Backdoor 路径**。

#### 1.3.2 Backdoor Adjustment 公式

**Backdoor Adjustment Set**: $\{X, T\}$（控制这两个变量后，$Z \rightarrow Y$ 的因果路径被打开）

**因果效应可识别性公式**:
$$P(Y|do(Z=z)) = \sum_{x,t} P(Y|Z=z, X=x, T=t) \cdot P(X=x, T=t)$$

**解释**:
- $do(Z=z)$: 对 $Z$ 的干预操作（强制设置加密强度为 $z$）
- 右侧: 在给定 $X=x, T=t$ 的条件下，观测到 $Y$ 的概率，然后对所有 $(x,t)$ 组合加权平均
- 权重 $P(X=x, T=t)$: 语义区域类型和任务类型的联合分布

#### 1.3.3 ATE 可识别性证明

**Average Treatment Effect (ATE) 定义**:
$$\tau_{ATE} = E[Y|do(Z=z_1)] - E[Y|do(Z=z_0)]$$

其中 $z_1$ 为高加密强度（如 0.9），$z_0$ 为低加密强度（如 0.3）。

**应用 Backdoor Adjustment**:
$$\tau_{ATE} = \sum_{x,t} \left[ E[Y|Z=z_1, X=x, T=t] - E[Y|Z=z_0, X=x, T=t] \right] \cdot P(X=x, T=t)$$

**简记**:
$$\tau_{ATE} = \sum_{x,t} \Delta(x,t) \cdot P(x,t)$$

其中 $\Delta(x,t) = E[Y|Z=z_1, X=x, T=t] - E[Y|Z=z_0, X=x, T=t]$ 是条件平均处理效应。

#### 1.3.4 CATE 可识别性证明

**Conditional Average Treatment Effect (CATE) 定义**:
$$\tau_{CATE}(X=x) = E[Y|do(Z=z_1), X=x] - E[Y|do(Z=z_0), X=x]$$

**应用 Backdoor Adjustment**（控制 $T$）:
$$\tau_{CATE}(X=x) = \sum_t \left[ E[Y|Z=z_1, X=x, T=t] - E[Y|Z=z_0, X=x, T=t] \right] \cdot P(T=t|X=x)$$

**简化形式**（当 $X$ 和 $T$ 独立时）:
$$\tau_{CATE}(X=x) = \sum_t \Delta(x,t) \cdot P(T=t)$$

#### 1.3.5 为什么满足可识别性条件？

虽然我们的加密策略 $Z = f(X, T)$ 是确定性的（非随机化），但在**数字图像加密场景**中，我们可以通过以下方式满足可识别性：

1. **完美反事实生成**（见数据集分析文档）:
   - 对于固定的 $(X, T)$，我们可以生成多个加密强度副本 $\{Z=z_k\}_{k=1}^K$
   - 这相当于"条件随机化"：给定 $(X, T)$，$Z$ 的取值是可控制的

2. **无混淆假设的满足**:
   - 控制 $X$ 和 $T$ 后，影响 $Y$ 的其他因素（图像内容、模型参数）在所有 $Z$ 取值下保持一致
   - 唯一变化的是加密强度 $Z$，因此观测到的 $Y$ 差异可以归因于 $Z$

3. **一致性假设**:
   - 干预 $do(Z=z)$ 等价于应用加密函数 $Encrypt(I, z)$，与观测到 $Z=z$ 时的加密结果一致

4. **正性假设**:
   - 对于任意 $(x, t)$，我们都可以生成任意 $z \in [0, 1]$ 的加密副本，因此 $P(Z=z|X=x, T=t) > 0$ 对所有 $(x,t,z)$ 成立

**结论**: 在数字图像加密场景中，由于反事实生成的完美性，Backdoor Adjustment 公式成立，ATE/CATE 可由观测数据一致估计。

### 1.4 安全模型

- 对称加密：ChaCha20  
- 置乱：Arnold固定迭代（避免可逆训练）  
- 扩散：5D超混沌序列，保证高NPCR/UACI  
- 频域扰动：FFT子带扰动，alpha 映射自 P(x,y)  
- 可验证性：Hash Commitment + HMAC-SHA512  
- 威胁模型：IND-CPA + 识别/重建攻击者  

---

## 二、因果效应可识别性证明（概要）

**注**: 详细的Backdoor Adjustment证明见1.3节，本节为概要总结。

### 2.1 目标

识别平均处理效应（ATE）和条件平均处理效应（CATE）:
- **ATE**: $\tau_{ATE} = E[Y|do(Z=z_1)] - E[Y|do(Z=z_0)]$
- **CATE**: $\tau_{CATE}(X=x) = E[Y|do(Z=z_1), X=x] - E[Y|do(Z=z_0), X=x]$

其中 $z_1$ 为高加密强度（如 0.9），$z_0$ 为低加密强度（如 0.3）。

### 2.2 可识别性条件

1. **一致性（Consistency）**: $Y = Y(Z)$  
   干预 $do(Z=z)$ 与观测到 $Z=z$ 的结果一致。

2. **无混淆（No Confounding）**: 给定 Backdoor Adjustment Set $\{X, T\}$ 后，$Z$ 对 $Y$ 的因果效应可识别。

3. **正性（Positivity）**: $\forall x,t,z$，$P(Z=z|X=x,T=t) > 0$  
   所有加密强度在所有语义区域和任务类型下都是可达的。

### 2.3 可识别性公式（Backdoor Adjustment）

**ATE 可识别性**:
$$E[Y|do(Z=z)] = \sum_{x,t} E[Y|Z=z, X=x, T=t] \cdot P(X=x, T=t)$$

**ATE 估计**:
$$\tau_{ATE} = \sum_{x,t} \Delta(x,t) \cdot P(x,t)$$

其中 $\Delta(x,t) = E[Y|Z=z_1, X=x, T=t] - E[Y|Z=z_0, X=x, T=t]$ 是条件平均处理效应。

**CATE 估计**:
$$\tau_{CATE}(X=x) = \sum_t \Delta(x,t) \cdot P(T=t|X=x)$$

### 2.4 数字图像场景的特殊性

在数字图像加密场景中，我们具备**完美反事实生成**能力：

- 对于固定图像 $I$ 及其语义区域 $(X, T)$，可以生成多个加密强度副本 $\{Encrypt(I, z_k)\}_{k=1}^K$
- 这等价于"条件随机化"：给定 $(X, T)$，$Z$ 的取值完全可控
- 消除了传统因果推断中的"数据缺失"问题（无法同时观测 $Y(1)$ 和 $Y(0)$）

**结论**: 在假设成立时，ATE/CATE 可由观测数据一致估计；因果报告基于可识别量，具有坚实的理论基础，避免"炼丹"式黑箱解释。  

---

## 三、隐私保护安全性论证（概要）

### 3.1 分层加密安全性

- Layer1 Arnold + 5D混沌扩散：强全局置乱与扩散，NPCR/UACI 接近理想随机。  
- Layer2 频域扰动：在强加密后叠加可控扰动，不削弱 IND-CPA。  
- 密钥体系：PBKDF2-HMAC-SHA512 + HKDF，满足 Kerckhoffs 原则。  
- 结论：满足 IND-CPA 前提下的组合安全；区域隐私预算仅调节附加扰动强度，不暴露密钥空间。  

### 3.2 抗识别/重建

- 识别率目标 <5%，理论上由置乱+扩散破坏身份特征，高频扰动进一步抑制。  
- 重建 PSNR <10 dB：高频扰动+扩散降低可逆性。  

---

## 四、可解释性与因果合理性

- 因果解释 = {ATE, CATE, 自然语言说明}  
- 正确性来源：可识别性 + 统计估计；解释不依赖黑箱规则。  
- 可信度：报告需给出方差/置信区间（实现时计算），避免伪解释。  

---

## 五、轻量级可验证性（Hash Commitment）

- 生成：C = H( HMAC(image, k_img) || HMAC(cipher, k_img) )  
- 验证：给定 cipher、C、k_img 可校验；不泄露区域密钥/混沌参数。  
- 复杂度：O(n) 线性时间，<10ms；证明大小 <1KB。  

安全性：预像/碰撞困难由 SHA-512 保障；HMAC 防篡改；无需重加密，轻量可部署。  

---

## 六、频域扰动可逆性与任务可用性

- 设计：LL 子带弱扰动，LH/HL/HH 强扰动，保障语义保留。  
- 可逆性：扰动幅度 α_low/α_high 受控；解密记录均值 α 以兼容逆变换。  
- 任务可用性：在 LL 保语义前提下，分类/分割性能可保持（需实验验证）。  

---

## 七、性能与理论边界

- 当前时间：~5.5 FPS；目标 >10 FPS。  
- 边界：隐私预算全1.0 时性能下降显著；因果指导用于寻找 Pareto 前沿。  
- 数据需求：ATE/CATE 估计需充足样本（≥1000）以降低方差。  

---

## 八、与相关工作的差异

- 非同态/SMC：不依赖重型密码学，效率高。  
- 非纯规则：因果推断提供理论支撑与解释。  
- 分层安全：先强加密再语义扰动，避免“局部弱加密”陷阱。  

---

## 九、待补充与验证

- 置信区间实现与显著性检验  
- 方差降低策略（重采样/稳健估计）  
- 可验证性原型性能测量  
- 更严安全模型（IND-CCA）作为扩展  
{
  "cells": [],
  "metadata": {
    "language_info": {
      "name": "python"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 2
}